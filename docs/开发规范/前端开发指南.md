# 前端开发指南

> **版本**: v2.0  
> **更新日期**: 2025-12-28  
> **适用项目**: dhs-atlas（AI 原生工作操作系统）

本文档是前端开发规范的**总入口**，汇总了所有开发规范文档的索引和核心规则。

---

## 一、AI 原生核心原则

### 1.1 最高约束

```
Human-only features are bugs.
If AI cannot operate it, it is not finished.

No fake intelligence.
No fake interaction.
No UI that AI cannot understand.
```

### 1.2 开发顺序（强制）

1. **定义操作语义**（Command / API / 状态变更）
2. **实现 AI 可调用能力**
3. **最后才允许 UI 封装**

> 禁止反向设计。UI 是状态的"视图"，不是逻辑的载体。

### 1.3 功能验收标准

每个 PR 必须回答：

> "如果我是 AI，而不是人，我是否能完整、正确、无歧义地使用这个功能？"

**不能 → PR 不允许合并。**

---

## 二、规范文档索引

### 核心规范（必读）

| 文档 | 说明 | 优先级 |
|------|------|--------|
| [开发伦理与系统操作宪章](../开发伦理与系统操作宪章-最高指示.md) | 最高级约束规范 | **宪法级** |
| [AI原生架构升级规划](../AI原生架构升级规划.md) | AI OS 层架构设计 | **必读** |
| [AI原生架构违规示例清单](../AI原生架构违规示例清单.md) | 35 个反模式 | **必读** |

### 样式规范

| 文档 | 说明 | 优先级 |
|------|------|--------|
| [UI样式使用规范](./UI样式使用规范.md) | shadcn/ui + Tailwind CSS 规范 | **强制** |
| [样式系统设计规范](./样式系统设计规范.md) | 完整的样式系统架构设计 | 参考 |
| [组件样式规范](./组件样式规范.md) | 通用组件的样式使用规范 | 参考 |

### 页面布局规范

| 文档 | 说明 | 优先级 |
|------|------|--------|
| [列表页面布局标准](./列表页面布局标准.md) | 列表页布局类型与状态处理 | 参考 |

---

## 三、技术栈概览

| 技术 | 版本 | 用途 |
|------|------|------|
| Next.js | 15.x | 框架（App Router） |
| React | 19.x | UI 库（RSC First） |
| TypeScript | 5.x | 类型系统（严格模式） |
| shadcn/ui | 最新 | UI 组件库（**唯一**） |
| Tailwind CSS | v4 | 样式框架 |
| Radix UI | 最新 | 无障碍原语组件 |
| Lucide React | 最新 | 图标库（**唯一**） |
| TanStack Query | v5 | 服务端状态管理 |
| TanStack Table | v8 | 表格组件 |
| Zustand | v5 | 客户端状态管理 |
| react-hook-form + zod | 最新 | 表单处理与验证 |

---

## 四、目录结构

```
src/
├── app/                      # Next.js App Router
│   ├── (auth)/               # 认证相关页面
│   └── (dashboard)/          # 主应用页面
│       └── dashboard/
│           ├── projects/     # 项目管理
│           ├── clients/      # 客户管理
│           ├── contracts/    # 合同管理
│           └── ...
├── components/
│   ├── ui/                   # shadcn 基础组件（勿修改）
│   ├── common/               # 通用业务组件
│   ├── layout/               # 布局组件
│   ├── features/             # 功能组件（按模块）
│   └── ai/                   # AI 交互原语组件
│       ├── AiForm.tsx
│       ├── AiPicker.tsx
│       ├── AiList.tsx
│       ├── AiDetails.tsx
│       ├── AiModalConfirm.tsx
│       ├── AiReviewPanel.tsx
│       ├── AiStepper.tsx
│       └── AiConsole.tsx
├── hooks/
│   └── queries/              # TanStack Query hooks
├── api/                      # API 请求封装
├── stores/                   # Zustand 状态管理
├── types/                    # TypeScript 类型定义
├── lib/                      # 工具库
└── commands/                 # Command 定义（AI 可调用）
```

---

## 五、核心开发规范

### 5.1 命名规范

| 类型 | 规范 | 示例 |
|------|------|------|
| 文件夹 | kebab-case | `user-management/` |
| 组件文件 | kebab-case.tsx | `data-table.tsx` |
| 页面文件 | 小写 | `page.tsx`, `layout.tsx` |
| Hooks | camelCase | `useProjects.ts` |
| 类型文件 | camelCase | `project.ts` |
| Command | kebab-case | `create-client.command.ts` |

### 5.2 组件开发规范

```tsx
'use client'; // 如需客户端功能

import { useState } from 'react';
import { Button } from '@/components/ui/button';

interface ComponentProps {
  title: string;
  onAction?: () => void;
}

export function MyComponent({ title, onAction }: ComponentProps) {
  const [loading, setLoading] = useState(false);
  
  return (
    <div className="my-component">
      <h2>{title}</h2>
      <Button onClick={onAction} disabled={loading}>
        操作
      </Button>
    </div>
  );
}
```

**规则**：
- ✅ 必须定义 Props 接口
- ✅ 使用函数组件 + Hooks
- ✅ 组件名使用 PascalCase
- ❌ 禁止使用 `any` 类型
- ❌ 禁止使用内联样式（动态样式除外）
- ❌ 禁止使用 Emoji

### 5.3 Command-First 开发模式

每个操作都必须先定义 Command：

```typescript
// commands/client/create-client.command.ts
import { z } from 'zod';

export const createClientCommand = {
  id: 'client.create',
  name: '创建客户',
  description: '创建一个新的客户记录',
  
  // 参数 Schema
  paramsSchema: z.object({
    name: z.string().min(1),
    type: z.enum(['enterprise', 'individual']),
    contact: z.string().optional(),
  }),
  
  // 执行函数
  execute: async (params) => {
    // 调用 API
  },
  
  // AI 决策级别
  level: 'L3', // 需要确认
  
  // 是否可撤销
  canUndo: true,
};
```

**三种触发方式（等价）**：

```typescript
// 1. AI 调用
await executeCommand('client.create', { name: 'XX公司', type: 'enterprise' });

// 2. UI 按钮点击
<Button onClick={() => executeCommand('client.create', formData)} />

// 3. 快捷键
registerShortcut('Ctrl+Shift+C', () => openCommandDialog('client.create'));
```

### 5.4 数据请求规范

使用 TanStack Query 进行数据请求：

```tsx
// hooks/queries/use-clients.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { clientApi } from '@/api/clients';
import { toast } from 'sonner';

export function useClients(params?: ClientQueryParams) {
  return useQuery({
    queryKey: ['clients', params],
    queryFn: () => clientApi.getList(params),
  });
}

export function useCreateClient() {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: clientApi.create,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['clients'] });
      toast.success('客户创建成功');
    },
    onError: (error) => {
      toast.error(error.message || '创建失败');
    },
  });
}
```

### 5.5 样式规范

**必须遵守**：

| 规则 | 说明 |
|------|------|
| ✅ 只使用 shadcn/ui | 禁止引入其他 UI 库 |
| ✅ 使用 Tailwind CSS | 禁止硬编码值 |
| ✅ 使用 Lucide Icons | 禁止其他图标库 |
| ❌ 禁止内联样式 | 动态样式除外 |
| ❌ 禁止 Emoji | 使用图标替代 |
| ❌ 禁止硬编码颜色 | 使用 CSS 变量 |

---

## 六、AI 交互原语组件

dhs-atlas 定义了 8 个交互原语组件，覆盖 80% 的 UI 场景：

| 组件 | 职责 | 典型场景 |
|------|------|---------|
| **AiForm** | 补充信息/创建/编辑 | 创建客户、编辑合同 |
| **AiPicker** | 单选/多选/枚举 | 选择模板、选择服务 |
| **AiList** | 列表+过滤+选中 | 搜索客户、选择合同 |
| **AiDetails** | 详情展示 | 客户详情、合同摘要 |
| **AiModalConfirm** | 确认/警告 | 删除确认、重要操作确认 |
| **AiReviewPanel** | 对比/勾选/审批 | 风险修订、合同对比 |
| **AiStepper** | 状态机进度 | 工作流步骤展示 |
| **AiConsole** | 事件流/日志 | 执行过程、可回放记录 |

**组件约束**：
- ✅ 严格 shadcn/ui（不魔改，不引第二套）
- ✅ 输入是 schema（props）
- ✅ 输出是 schema（events）
- ❌ 不包含业务逻辑
- ✅ 可由 AI 声明式渲染

---

## 七、开发流程

### 7.1 新功能开发流程

1. **阅读规范** → [开发伦理与系统操作宪章](../开发伦理与系统操作宪章-最高指示.md)
2. **定义 Command** → 明确操作语义、参数 Schema
3. **实现后端能力** → Tool 可被 AI 调用
4. **创建 UI** → 使用交互原语组件
5. **验证** → AI 是否能无歧义操作

### 7.2 新建组件流程

1. 确定组件位置：
   - 通用组件 → `components/common/`
   - UI 基础组件 → `components/ui/`（通过 shadcn 添加）
   - 功能组件 → `components/features/[module]/`
   - AI 交互原语 → `components/ai/`
2. 创建组件文件，定义 Props 接口
3. 编写组件样式（使用 Tailwind）
4. 确保 AI 可理解和操作

### 7.3 代码审查清单

**AI 原生检查**：
- [ ] 功能是否 AI 可操作？
- [ ] 是否定义了 Command？
- [ ] 是否使用了 Emoji？（禁止）

**样式检查**：
- [ ] 是否只使用 shadcn/ui？
- [ ] 是否使用了内联样式？（禁止，动态除外）
- [ ] 是否使用了硬编码颜色/间距？

**代码质量检查**：
- [ ] 是否定义了 Props 类型？
- [ ] 是否处理了 loading/empty/error 状态？
- [ ] 是否添加了操作反馈（toast）？

---

## 八、多企业架构约束

dhs-atlas 是 Multi-Tenant 架构，所有数据必须绑定 `enterpriseId`：

```typescript
// ❌ 错误 - 缺少企业绑定
const client = await db.client.create({
  data: { name: 'XX公司' }
});

// ✅ 正确 - 绑定企业
const client = await db.client.create({
  data: { 
    name: 'XX公司',
    enterpriseId: context.enterpriseId // 必须
  }
});
```

**所有以下对象必须绑定 enterprise scope**：
- 业务数据（客户、合同、项目等）
- Tool 定义
- Workflow 定义
- Role / Policy
- AI 行为日志

---

## 版本历史

| 版本 | 日期 | 变更内容 |
|------|------|---------|
| **v2.0** | 2025-12-28 | 重构为 dhs-atlas AI 原生规范 |
| **v1.0** | 2025-12-08 | 初始版本 |

---

**文档维护**: dhs-atlas 开发团队  
**最高约束**: [开发伦理与系统操作宪章](../开发伦理与系统操作宪章-最高指示.md)
