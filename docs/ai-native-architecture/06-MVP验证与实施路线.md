# 06 - MVP 验证与实施路线

> **所属文档**: AI 原生架构升级规划  
> **章节**: 九
> **核心原则**: 不写新文档，不加新功能。先用新架构跑通一个最小闭环。

---

## 九、最小闭环验证（MVP）

### 9.1 为什么要先做最小闭环

之前的问题是：
- 在一个局部功能里承载了整个系统复杂度
- 越做越累，体验越调越不对

现在要做的是：
- 用新架构验证"承载复杂度的位置"是否正确
- 如果最小闭环跑顺，之前所有的痛点都会自动消失

### 9.2 选择验证场景

**推荐场景 A：创建客户**
- 简单、直观、容易验证
- 涉及表单操作，可验证"画布"设计
- 后续可自然延伸到报价、合同

**推荐场景 B：分析一份合同（推荐）**
- 能验证工具调用（解析、风险扫描）
- 能验证实时流式反馈
- 能验证结果展示和人工接管
- 能验证完整的 Workflow 状态机

**analyze_document 工作流详细设计**：

```
┌─────────────────────────────────────────────────────────────────────┐
│                    analyze_document 工作流                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  State 1: upload                                                    │
│  ├─ Tools: files.upload, files.extract_text                        │
│  ├─ UI: AiForm (文件上传)                                           │
│  └─ → file.uploaded → analyzing                                    │
│                                                                     │
│  State 2: analyzing                                                 │
│  ├─ Tools: contract.parse, contract.risk_scan                      │
│  ├─ UI: AiStepper + AiConsole (真实进度)                            │
│  └─ → analysis.complete → review                                   │
│                                                                     │
│  State 3: review                                                    │
│  ├─ Tools: contract.propose_patch                                  │
│  ├─ UI: AiReviewPanel + AiDetails (风险+修订建议)                   │
│  ├─ → user.approve → applying                                      │
│  └─ → user.reject → done                                           │
│                                                                     │
│  State 4: applying                                                  │
│  ├─ Tools: contract.apply_patch                                    │
│  ├─ UI: AiModalConfirm + AiConsole                                 │
│  └─ → patch.applied → done                                         │
│                                                                     │
│  State 5: done (Final)                                              │
│  └─ UI: AiDetails (最终结果)                                        │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

这一个闭环跑通，整套架构就立住了。

### 9.3 验证标准（必须全部满足）

| 要求 | 说明 |
|------|------|
| ✅ **只通过 AI 助手入口** | 不使用传统页面按钮 |
| ✅ **只用 Tool / Workflow** | 所有能力都是工具调用 |
| ✅ **只用对话流 + 画布** | 对话指挥，画布执行 |
| ✅ **人和 AI 操作完全等价** | 同一个 Command，谁都能触发 |
| ✅ **规划过程可见可改** | Agent 计划步骤可展示、可修改 |
| ✅ **决策分级生效** | 根据任务级别决定自动/确认 |

### 9.4 最小闭环的交互流程（以「创建客户」为例）

```
┌─────────────────────────────────────────────────────────────────────┐
│ 步骤 1：用户唤起 AI 助手                                             │
├─────────────────────────────────┬───────────────────────────────────┤
│          对话流                  │              画布                 │
│                                 │                                   │
│ [点击右下角 AI 按钮]            │  ┌─────────────────────────────┐ │
│                                 │  │ 📍 当前：首页               │ │
│                                 │  │                             │ │
│ 🤖 你好！我是你的 AI 助手       │  │ 🛠️ 可用工具                  │ │
│    当前在首页，我可以帮你：     │  │ [搜索] [新建] [统计] [导航] │ │
│                                 │  │                             │ │
│    💡 快捷指令：                │  │ ⚡ 快捷工作流               │ │
│    [创建客户] [查看报价]        │  │ [创建客户] [生成报价]       │ │
│    [分析合同] [查看统计]        │  │                             │ │
│                                 │  └─────────────────────────────┘ │
└─────────────────────────────────┴───────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│ 步骤 2：用户发起指令                                                 │
├─────────────────────────────────┬───────────────────────────────────┤
│          对话流                  │              画布                 │
│                                 │                                   │
│ 👤 帮我创建一个客户，           │                                   │
│    叫做 XX 设计公司             │                                   │
│                                 │                                   │
│ 🤖 收到，我来帮你创建客户       │                                   │
│                                 │                                   │
│    ┌───────────────────────┐   │                                   │
│    │ 📋 执行计划            │   │                                   │
│    │                        │   │                                   │
│    │ 1. 调用「创建客户」工具│   │                                   │
│    │    参数：              │   │                                   │
│    │    - 名称: XX 设计公司 │   │                                   │
│    │    - 类型: 企业        │   │                                   │
│    │                        │   │                                   │
│    │ [确认执行] [修改] [取消]   │                                   │
│    └───────────────────────┘   │                                   │
│                                 │                                   │
└─────────────────────────────────┴───────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│ 步骤 3：用户确认，AI 在画布中打开表单                                │
├─────────────────────────────────┬───────────────────────────────────┤
│          对话流                  │              画布                 │
│                                 │                                   │
│ 👤 [点击确认执行]               │  ┌─────────────────────────────┐ │
│                                 │  │ ➕ 新建客户                 │ │
│ 🤖 好的，我打开了创建表单       │  ├─────────────────────────────┤ │
│    正在填写你提供的信息...      │  │                             │ │
│                                 │  │ 客户名称                    │ │
│    ┌───────────────────────┐   │  │ [XX 设计公司] ← AI 正在填   │ │
│    │ 🔄 正在填写表单        │   │  │  ↑ 高亮 + 打字动画          │ │
│    │ ████████░░ 80%         │   │  │                             │ │
│    └───────────────────────┘   │  │ 客户类型                    │ │
│                                 │  │ [企业 ▼] ← AI 自动选择      │ │
│                                 │  │                             │ │
│                                 │  │ 联系人  [          ]        │ │
│                                 │  │ 电话    [          ]        │ │
│                                 │  │ 地址    [          ]        │ │
│                                 │  │                             │ │
│                                 │  │ [保存] [取消]               │ │
│                                 │  └─────────────────────────────┘ │
└─────────────────────────────────┴───────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│ 步骤 4：AI 填写完成，等待用户补充或确认                              │
├─────────────────────────────────┬───────────────────────────────────┤
│          对话流                  │              画布                 │
│                                 │                                   │
│ 🤖 我已填入客户名称和类型       │  ┌─────────────────────────────┐ │
│    你可以补充联系人信息，       │  │ ➕ 新建客户                 │ │
│    或者直接保存                 │  ├─────────────────────────────┤ │
│                                 │  │                             │ │
│    💡 下一步：                  │  │ 客户名称                    │ │
│    [直接保存]                   │  │ [XX 设计公司] ✅            │ │
│    [我来补充联系人]             │  │                             │ │
│    [帮我查一下这个公司的信息]   │  │ 客户类型                    │ │
│                                 │  │ [企业 ▼] ✅                 │ │
│                                 │  │                             │ │
│                                 │  │ 联系人  [          ] ← 光标 │ │
│                                 │  │ 电话    [          ]        │ │
│                                 │  │ 地址    [          ]        │ │
│                                 │  │                             │ │
│                                 │  │ [保存] [取消]               │ │
│                                 │  └─────────────────────────────┘ │
│                                 │                                   │
│                                 │  用户可以直接在画布中手动填写    │
└─────────────────────────────────┴───────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│ 步骤 5：保存完成，预判下一步                                         │
├─────────────────────────────────┬───────────────────────────────────┤
│          对话流                  │              画布                 │
│                                 │                                   │
│ 👤 [点击保存] 或 说"保存"       │  ┌─────────────────────────────┐ │
│                                 │  │ ✅ 客户创建成功             │ │
│ 🤖 客户「XX 设计公司」          │  ├─────────────────────────────┤ │
│    创建成功！                   │  │                             │ │
│                                 │  │ 客户名称：XX 设计公司       │ │
│    💡 下一步你可能想：          │  │ 联系人：张三                │ │
│                                 │  │ 电话：138xxxx               │ │
│    [为这个客户创建报价单]       │  │ 创建时间：2024-12-28        │ │
│    [添加更多联系人]             │  │                             │ │
│    [查看客户列表]               │  │ [编辑] [创建报价] [创建合同]│ │
│    [创建另一个客户]             │  └─────────────────────────────┘ │
│                                 │                                   │
└─────────────────────────────────┴───────────────────────────────────┘
```

### 9.5 验证检查清单

完成最小闭环后，逐项检查：

| 检查项 | 是否通过 |
|--------|---------|
| 整个流程只通过 AI 助手完成 | ☐ |
| 画布中的表单，人可以直接手动填写 | ☐ |
| AI 的执行计划在执行前可见 | ☐ |
| 用户可以修改 AI 的计划 | ☐ |
| AI 填写表单时有视觉反馈 | ☐ |
| 人的修改 AI 能实时感知 | ☐ |
| 创建操作需要用户确认（L3级） | ☐ |
| 点击画布按钮和 AI 执行走同一个 Command | ☐ |
| 操作记录在统一日志中 | ☐ |
| 完成后有合理的预判指令 | ☐ |

---

## 实施路线

| 阶段 | 内容 | 价值 |
|------|------|------|
| **P0** | 统一 AI 助手组件框架 + Agent 服务骨架 | 建立基础架构 |
| **P1** | 页面感知 + 5 个核心工具 + 导航能力 | 基本可用 |
| **P2** | 工作流引擎 + 3 个核心工作流 | 复杂任务自动化 |
| **P3** | 对话历史 + 上下文记忆 | 连续性体验 |
| **P4** | 主动提示 + 智能推荐 | 超越被动响应 |

---

## 下一步

- [07-风险与防护机制](./07-风险与防护机制.md) - 了解风险防护设计
- [08-核心原则与红线](./08-核心原则与红线.md) - 了解核心原则和架构红线

