# 04 - 架构概览

> **所属文档**: AI 原生架构升级规划  
> **章节**: 五、六、七

---

## 五、架构概览

### 5.1 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                        前端应用                              │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                   当前页面内容                         │  │
│  │                                        ┌────────────┐ │  │
│  │                                        │ AI 助手    │ │  │
│  │                                        │  (悬浮)    │ │  │
│  │                                        └────────────┘ │  │
│  └───────────────────────────────────────────────────────┘  │
│                             │                                │
│                             ▼                                │
│  ┌───────────────────────────────────────────────────────┐  │
│  │              AIAssistant 核心组件                      │  │
│  │  • 页面感知    • 对话管理    • 工具调度               │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                      后端 Agent 服务                         │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  意图识别 → 任务规划 → 工具执行 → 结果整合          │   │
│  └─────────────────────────────────────────────────────┘   │
│                             │                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    工具注册表                         │   │
│  │  合同解析 | 风险扫描 | 客户查询 | 报价计算 | ...     │   │
│  └─────────────────────────────────────────────────────┘   │
│                             │                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                   工作流注册表                        │   │
│  │  合同导入流程 | 合同创建流程 | 客户跟进流程 | ...    │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 数据流

```
用户输入
    │
    ▼
页面上下文收集
    │
    ▼
发送到 Agent 服务
    │
    ├──→ 意图识别（理解用户想做什么）
    │
    ├──→ 任务规划（确定需要哪些工具/工作流）
    │
    ├──→ 工具执行（实时流式反馈）
    │        │
    │        ├──→ 工具开始事件
    │        ├──→ 工具进度事件（多次）
    │        └──→ 工具完成事件
    │
    └──→ 结果整合（生成自然语言回复）
              │
              ▼
         流式返回前端
              │
              ▼
         实时渲染展示
```

### 5.3 关键组件

| 组件 | 职责 |
|------|------|
| **页面感知器** | 收集当前页面上下文信息 |
| **意图识别器** | 理解用户自然语言意图 |
| **任务规划器** | 规划执行步骤，选择工具/工作流 |
| **工具执行器** | 执行具体工具，报告进度 |
| **工作流执行器** | 编排多步骤工作流 |
| **响应组合器** | 将结果转化为自然语言回复 |

---

## 六、与现有系统的关系

### 6.1 复用现有能力

现有的 AI 服务将作为「工具」被复用：

| 现有服务 | 转化为工具 |
|----------|-----------|
| ContractParserService | parse_contract 工具 |
| RiskScanService | scan_risks 工具 |
| TemplateAnalysisService | analyze_template 工具 |
| ContractAIService | generate_contract 工具 |
| ContractConversationService | 融入对话流程 |
| PreflightService | 融入工作流 |

### 6.2 渐进式迁移

**阶段一**：
- 构建统一 AI 助手框架
- 将现有服务封装为工具
- 保留原有页面入口

**阶段二**：
- 完善工作流编排
- 优化页面感知
- 丰富快捷操作

**阶段三**：
- 简化原有页面（移除冗余 AI 入口）
- AI 助手成为主要交互方式
- 原有入口作为备用

---

## 七、成功指标

### 7.1 体验指标

| 指标 | 目标 |
|------|------|
| 任务完成步骤数 | 减少 50%（AI 自动编排） |
| 页面跳转次数 | 减少 70%（AI 自动导航） |
| 用户学习成本 | 接近零（对话即操作） |

### 7.2 效率指标

| 指标 | 目标 |
|------|------|
| 合同分析完成时间 | 从 10 分钟降至 2 分钟 |
| 新合同创建时间 | 从 30 分钟降至 5 分钟 |
| 信息查询时间 | 即问即答 |

### 7.3 技术指标

| 指标 | 目标 |
|------|------|
| 工具调用准确率 | > 95% |
| 意图识别准确率 | > 90% |
| 响应延迟（首字符） | < 500ms |
| 工具执行可见性 | 100% 实时反馈 |

---

## 下一步

- [05-工程架构-协议与包结构](./05-工程架构-协议与包结构.md) - 了解协议和工程实现
- [06-MVP验证与实施路线](./06-MVP验证与实施路线.md) - 了解如何开始实施

