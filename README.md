# DHS-Atlas ä¼ä¸šç®¡ç†ç³»ç»Ÿ

> ä¸€ä¸ªé›†æˆ AI èƒ½åŠ›çš„ä¼ä¸šç®¡ç†ç³»ç»Ÿï¼ŒåŒ…å« CRMã€æŠ¥ä»·ç®¡ç†ã€æœåŠ¡æµç¨‹ç­‰åŠŸèƒ½ã€‚

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [å¿«é€Ÿå¯åŠ¨](#å¿«é€Ÿå¯åŠ¨)
- [æœåŠ¡è¯¦æƒ…](#æœåŠ¡è¯¦æƒ…)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
- [ç¯å¢ƒå˜é‡](#ç¯å¢ƒå˜é‡)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸ— ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DHS-Atlas ç³»ç»Ÿ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     Docker Compose                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  MongoDB    â”‚  â”‚  åç«¯ API   â”‚  â”‚     AI Agent        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   :27017    â”‚â—€â”€â”‚  (Node.js)  â”‚â—€â”€â”‚  (Python/FastAPI)   â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   :3000     â”‚  â”‚      :8000          â”‚  â”‚   â”‚
â”‚  â”‚        â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚   â”‚
â”‚  â”‚  â”‚ Mongo       â”‚                                             â”‚   â”‚
â”‚  â”‚  â”‚ Express     â”‚                                             â”‚   â”‚
â”‚  â”‚  â”‚  :8081      â”‚                                             â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â–²                                      â”‚
â”‚                              â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   å‰ç«¯       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚      LLM æœåŠ¡           â”‚  â”‚
â”‚  â”‚  (Next.js)  â”‚  æœ¬åœ°è¿è¡Œ              â”‚   (LMStudio/OpenAI)    â”‚  â”‚
â”‚  â”‚  :3001      â”‚  æ”¯æŒçƒ­é‡è½½            â”‚   192.168.31.177:1234  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆDocker + å‰ç«¯ï¼‰
./scripts/start.sh

# åœæ­¢æ‰€æœ‰æœåŠ¡
./scripts/stop.sh
```

### æ—¥å¸¸å¼€å‘

åªéœ€ **2 ä¸ªç»ˆç«¯**ï¼š

```bash
# ç»ˆç«¯ 1: å¯åŠ¨ Dockerï¼ˆåç«¯ + AI Agent + MongoDBï¼‰
docker-compose up

# ç»ˆç«¯ 2: å¯åŠ¨å‰ç«¯ï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
./scripts/frontend.sh
```

### é¦–æ¬¡è¿è¡Œ

```bash
# 1. å®‰è£…å‰ç«¯ä¾èµ–
cd frontend && npm install && cd ..

# 2. å¯åŠ¨æ‰€æœ‰æœåŠ¡
./scripts/start.sh --rebuild
```

### åå°è¿è¡Œ

```bash
# Docker æœåŠ¡åå°è¿è¡Œ
docker-compose up -d

# å¯åŠ¨å‰ç«¯
./scripts/frontend.sh

# åœæ­¢æ‰€æœ‰
./scripts/stop.sh
```

---

## ğŸ“Š æœåŠ¡ç«¯å£æ±‡æ€»

| ç«¯å£ | æœåŠ¡ | è¿è¡Œä½ç½® | è¯´æ˜ |
|------|------|----------|------|
| **3001** | å‰ç«¯ | æœ¬åœ° | Next.jsï¼ˆçƒ­é‡è½½ï¼‰ |
| 3000 | åç«¯ API | Docker | Node.js Express |
| 8000 | AI Agent | Docker | Python FastAPI |
| 8081 | Mongo Express | Docker | æ•°æ®åº“ç®¡ç† |
| 27017 | MongoDB | Docker | æ•°æ®åº“ |

### è®¿é—®åœ°å€

- ğŸŒ **å‰ç«¯ç•Œé¢**ï¼šhttp://localhost:3001
- ğŸ”Œ **åç«¯ API**ï¼šhttp://localhost:3000
- ğŸ¤– **AI Agent**ï¼šhttp://localhost:8000
- ğŸ“Š **æ•°æ®åº“ç®¡ç†**ï¼šhttp://localhost:8081
  - ç”¨æˆ·åï¼š`aiden`
  - å¯†ç ï¼š`633234001`

---

## ğŸ“¦ æœåŠ¡è¯¦æƒ…

### Docker æœåŠ¡ï¼ˆdocker-compose.ymlï¼‰

| æœåŠ¡ | å®¹å™¨å | é•œåƒ/æ„å»º | è¯´æ˜ |
|------|--------|-----------|------|
| mongodb | donhauser-mongodb | mongo:7.0 | ä¸»æ•°æ®åº“ |
| backend | donhauser-backend | ./backend | Node.js API |
| agent | donhauser-agent | ./dhs_atlas_agent | Python AI Agent |
| mongo-express | donhauser-mongo-express | mongo-express | æ•°æ®åº“ UI |

### å‰ç«¯ï¼ˆæœ¬åœ°è¿è¡Œï¼‰

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| ç›®å½• | `frontend/` |
| ç«¯å£ | 3001 |
| æ¡†æ¶ | Next.js 16 + React 19 |
| å¯åŠ¨ | `cd frontend && npm run dev` |

---

## ğŸ”§ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
dhs-atlas/
â”œâ”€â”€ backend/                 # Node.js åç«¯ (Docker)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ controllers/    # æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ models/         # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ routes/         # è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ services/       # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â””â”€â”€ ai/             # AI ç›¸å…³
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ frontend/               # Next.js å‰ç«¯ (æœ¬åœ°)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/           # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ components/    # ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ api/           # API å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ hooks/         # è‡ªå®šä¹‰ Hooks
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ dhs_atlas_agent/        # Python AI Agent (Docker)
â”‚   â”œâ”€â”€ agents/            # Agent å®šä¹‰
â”‚   â”œâ”€â”€ tools/             # AI å·¥å…·
â”‚   â”œâ”€â”€ api/               # FastAPI æœåŠ¡
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ docs/                   # æ–‡æ¡£
â”‚   â””â”€â”€ å¼€å‘è§„èŒƒ/          # å¼€å‘è§„èŒƒ
â”‚
â”œâ”€â”€ docker-compose.yml      # Docker é…ç½®
â””â”€â”€ README.md
```

### å¼€å‘è§„èŒƒ

âš ï¸ **é‡è¦ï¼šè¯·åŠ¡å¿…é˜…è¯»ä»¥ä¸‹è§„èŒƒæ–‡æ¡£**

- UI æ ·å¼è§„èŒƒï¼š`docs/å¼€å‘è§„èŒƒ/UIæ ·å¼ä½¿ç”¨è§„èŒƒ.md`
- åˆ—è¡¨é¡µå¸ƒå±€ï¼š`docs/å¼€å‘è§„èŒƒ/åˆ—è¡¨é¡µé¢å¸ƒå±€æ ‡å‡†.md`
- ç»„ä»¶æ ·å¼ï¼š`docs/å¼€å‘è§„èŒƒ/ç»„ä»¶æ ·å¼è§„èŒƒ.md`

---

## ğŸŒ ç¯å¢ƒå˜é‡

### Docker ç¯å¢ƒå˜é‡ï¼ˆ.env æ–‡ä»¶ï¼Œå¯é€‰ï¼‰

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# LLM æœåŠ¡é…ç½®ï¼ˆé»˜è®¤ä½¿ç”¨å±€åŸŸç½‘ LMStudioï¼‰
LLM_BASE_URL=http://192.168.31.177:1234
LLM_MODEL=qwen/qwen3-coder-30b
LLM_API_KEY=lm-studio
```

### å‰ç«¯ç¯å¢ƒå˜é‡ï¼ˆfrontend/.env.localï¼‰

```bash
NEXT_PUBLIC_API_URL=http://localhost:3000/api
NEXT_PUBLIC_AGENT_API=http://localhost:8000/api/agent
```

---

## ğŸ“œ è„šæœ¬è¯´æ˜

æ‰€æœ‰è„šæœ¬ä½äº `scripts/` ç›®å½•ï¼Œå·²è®¾ç½®æ‰§è¡Œæƒé™ã€‚

| è„šæœ¬ | åŠŸèƒ½ | å¸¸ç”¨å‘½ä»¤ |
|------|------|----------|
| `start.sh` | ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡ | `./scripts/start.sh` |
| `stop.sh` | åœæ­¢æ‰€æœ‰æœåŠ¡ | `./scripts/stop.sh` |
| `restart.sh` | é‡å¯ Docker å®¹å™¨ | `./scripts/restart.sh` |
| `rebuild.sh` | æ¸…ç†ç¼“å­˜ã€é‡å»º Docker | `./scripts/rebuild.sh` |
| `frontend.sh` | å‰ç«¯æœåŠ¡ç®¡ç† | `./scripts/frontend.sh` |

### è¯¦ç»†ç”¨æ³•

```bash
# ä¸€é”®å¯åŠ¨
./scripts/start.sh              # å¯åŠ¨ Docker + å‰ç«¯
./scripts/start.sh --docker-only # ä»…å¯åŠ¨ Docker
./scripts/start.sh --rebuild    # é‡æ–°æ„å»ºåå¯åŠ¨

# åœæ­¢æœåŠ¡
./scripts/stop.sh               # åœæ­¢æ‰€æœ‰

# é‡å¯ Docker å®¹å™¨
./scripts/restart.sh            # é‡å¯æ‰€æœ‰å®¹å™¨
./scripts/restart.sh --backend  # ä»…é‡å¯åç«¯
./scripts/restart.sh --agent    # ä»…é‡å¯ AI Agent

# é‡å»º Docker æœåŠ¡ï¼ˆä»£ç æ›´æ–°åï¼‰
./scripts/rebuild.sh            # é‡å»ºæ‰€æœ‰
./scripts/rebuild.sh --backend  # ä»…é‡å»ºåç«¯
./scripts/rebuild.sh --agent    # ä»…é‡å»º AI Agent
./scripts/rebuild.sh --no-cache # æ— ç¼“å­˜é‡å»º
./scripts/rebuild.sh --clean    # æ·±åº¦æ¸…ç†åé‡å»º

# å‰ç«¯æœåŠ¡
./scripts/frontend.sh           # å¯åŠ¨å‰ç«¯
./scripts/frontend.sh stop      # åœæ­¢å‰ç«¯
./scripts/frontend.sh restart   # é‡å¯å‰ç«¯
./scripts/frontend.sh build     # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
./scripts/frontend.sh install   # é‡è£…ä¾èµ–åå¯åŠ¨
```

---

## ğŸ›  å¸¸ç”¨å‘½ä»¤

### Docker æ“ä½œ

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up

# åå°å¯åŠ¨
docker-compose up -d

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose up --build

# åªé‡å»ºæŸä¸ªæœåŠ¡
docker-compose up --build backend
docker-compose up --build agent

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
docker-compose logs -f backend
docker-compose logs -f agent

# åœæ­¢æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·ï¼ˆæ…ç”¨ï¼ä¼šåˆ é™¤æ•°æ®åº“ï¼‰
docker-compose down -v

# è¿›å…¥å®¹å™¨è°ƒè¯•
docker exec -it donhauser-backend sh
docker exec -it donhauser-agent bash
```

### å‰ç«¯æ“ä½œ

```bash
cd frontend

# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ¨¡å¼
npm run dev

# æ„å»º
npm run build

# ç”Ÿäº§æ¨¡å¼
npm start
```

---

## â“ å¸¸è§é—®é¢˜

### Q: Docker å¯åŠ¨æŠ¥é”™ï¼Ÿ

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
docker-compose logs

# é‡æ–°æ„å»º
docker-compose down
docker-compose up --build
```

### Q: AI Agent è¿æ¥ LLM å¤±è´¥ï¼Ÿ

1. ç¡®è®¤ LLM æœåŠ¡è¿è¡Œä¸­ï¼š
```bash
curl http://192.168.31.177:1234/v1/models
```

2. å¦‚æœ LLM åœ¨æœ¬æœºè¿è¡Œï¼Œéœ€è¦ç”¨ `host.docker.internal`ï¼š
```bash
# åœ¨ .env ä¸­è®¾ç½®
LLM_BASE_URL=http://host.docker.internal:1234
```

### Q: å‰ç«¯è¿æ¥åç«¯å¤±è´¥ï¼Ÿ

ç¡®è®¤ Docker æœåŠ¡å·²å¯åŠ¨ï¼š
```bash
curl http://localhost:3000/api/health
curl http://localhost:8000/api/health
```

### Q: ç«¯å£è¢«å ç”¨ï¼Ÿ

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :3000
lsof -i :8000

# åœæ­¢æ‰€æœ‰ Docker å®¹å™¨
docker-compose down
```

### Q: å¦‚ä½•æ¸…ç† Docker èµ„æºï¼Ÿ

```bash
# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker-compose down

# åˆ é™¤æœªä½¿ç”¨çš„é•œåƒ
docker image prune

# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æºï¼ˆè°¨æ…ï¼‰
docker system prune -a
```

---

## ğŸš€ éƒ¨ç½²

### å±€åŸŸç½‘éƒ¨ç½²

```bash
docker-compose -f docker-compose.lan.yml up -d
```

### ç”Ÿäº§éƒ¨ç½²

1. ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼ˆJWT_SECRET ç­‰ï¼‰
2. æ„å»ºç”Ÿäº§é•œåƒ
3. ä½¿ç”¨ docker-compose.lan.yml æˆ–è‡ªå®šä¹‰é…ç½®

---

## ğŸ“ å¼€å‘å·¥ä½œæµ

```
1. å¯åŠ¨ Docker:     docker-compose up -d
2. å¯åŠ¨å‰ç«¯:        cd frontend && npm run dev
3. å¼€å§‹å¼€å‘ï¼
4. ä¿®æ”¹å‰ç«¯ä»£ç  â†’ è‡ªåŠ¨çƒ­é‡è½½
5. ä¿®æ”¹åç«¯ä»£ç  â†’ éœ€è¦é‡å¯ Docker æˆ–é‡å»º
6. å®Œæˆå:          docker-compose down
```

---

**æœ€åæ›´æ–°ï¼š** 2025-12-31
